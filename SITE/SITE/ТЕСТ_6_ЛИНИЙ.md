# ⚡ Быстрый тест - 6 независимых линий

## Запуск
```bash
cd SITE
npm run dev
```

Откройте: `http://localhost:5173/futures-dashboard`

---

## ✅ Тест #1: Начальное состояние

### Ожидаемое
**По умолчанию видны:**
- ✅ Цена (темная область - фон)
- ✅ Юр. NET (золотая пунктирная линия)

**Скрыты:**
- ✅ Юр. Long, Юр. Short
- ✅ Физ. Long, Физ. Short, Физ. NET

**Консоль (F12):**
```
[FuturesDashboard] 👁️ Visible lines: {
  yur: { long: false, short: false, net: true },
  fiz: { long: false, short: false, net: false }
}
[FuturesDashboard] ➕ Added Юр. NET values
[FuturesDashboard] 📐 Domain: { final: [..., ...] }
```

**UI Проверка:**
```
┌────────────────────────────────────┐
│ 🏢 ЮРИДИЧЕСКИЕ ЛИЦА               │
│ [👁️off Юр. Long]  серая кнопка   │
│ [👁️off Юр. Short] серая кнопка   │
│ [👁️ Юр. NET]      золотая кнопка  │ ← Активна!
├────────────────────────────────────┤
│ 👥 ФИЗИЧЕСКИЕ ЛИЦА                │
│ [👁️off Физ. Long]  все серые     │
│ [👁️off Физ. Short]                │
│ [👁️off Физ. NET]                  │
└────────────────────────────────────┘
```

---

## ✅ Тест #2: Показать Юр. Long (фиолетовая)

### Действие
Кликните на `👁️off Юр. Long`

### Ожидаемое

**Кнопка изменилась:**
- Фон: серый → **фиолетовый**
- Иконка: `👁️off EyeOff` → `👁️ Eye`
- Текст: серый → **фиолетовый**

**График:**
```
Y-ось справа: 0 - 8M  (широкий диапазон)

Линии:
[Фиолетовая толстая ━━━]  ← Юр. Long (7M) - ПОЯВИЛАСЬ!
[Золотая пунктир - - -]   ← Юр. NET (200K) - была
```

**Консоль:**
```
[FuturesDashboard] 👁️ Visible lines: {
  yur: { long: true, short: false, net: true },
  ...
}
[FuturesDashboard] ➕ Added Юр. Long values
[FuturesDashboard] ➕ Added Юр. NET values
[FuturesDashboard] 📐 Domain: { final: [-100000, 7500000] }
                                        ↑ Новый диапазон
```

**Stats Grid:**
```
┌─────────────────────────┐
│ 🏢 Юр. Long      👁️    │ ← Eye иконка появилась!
│ 7.2 млн                 │
└─────────────────────────┘
```

---

## ✅ Тест #3: Dynamic Scaling (только Физ. Long)

### Действие
1. **Скрыть** все видимые линии:
   - Клик на `👁️ Юр. Long` → Скрыть
   - Клик на `👁️ Юр. NET` → Скрыть
   
2. **Показать** Физ. Long:
   - Клик на `👁️off Физ. Long`

### Ожидаемое

**График:**
```
Y-ось справа: 1.10M - 1.25M  ← УЗКИЙ диапазон!

График:
[Зеленая тонкая ╱╲╱╲╱]  ← Физ. Long - РАСТЯНУТА!
```

**Консоль:**
```
[FuturesDashboard] 👁️ Visible lines: {
  yur: { long: false, short: false, net: false },
  fiz: { long: true, short: false, net: false }
}
[FuturesDashboard] ➕ Added Физ. Long values
[FuturesDashboard] 📐 Domain: { final: [1100000, 1250000] }
                                        ↑ Только Физ. Long!
```

**Debug Info:**
```
Текущий диапазон Y-оси (правая): [1100000, 1250000]
Видимых линий: 1 из 6
```

---

## ✅ Тест #4: Long vs Short (Юр. лица)

### Действие
1. Скрыть **Физ. Long** (клик `👁️ Физ. Long`)
2. Показать **Юр. Long** (клик `👁️off Юр. Long`)
3. Показать **Юр. Short** (клик `👁️off Юр. Short`)

### Ожидаемое

**График:**
```
Y-ось справа: 6.5M - 7.5M

Линии:
[Фиолетовая толстая ━━━]  ← Юр. Long (7.2M)
[Красная толстая ━━━]     ← Юр. Short (6.8M)
```

**Визуальный анализ:**
- ✅ Обе линии **толстые** (3px)
- ✅ Фиолетовая **выше** красной → NET = +400K (Long преобладает)
- ✅ Линии **параллельны** → Стабильный баланс

**Консоль:**
```
[FuturesDashboard] ➕ Added Юр. Long values
[FuturesDashboard] ➕ Added Юр. Short values
[FuturesDashboard] 📐 Domain: { final: [6500000, 7500000] }
```

---

## ✅ Тест #5: Все 6 линий (полная картина)

### Действие
Показать **ВСЕ** 6 линий (клик на каждую скрытую кнопку)

### Ожидаемое

**График:**
```
Y-ось справа: -500K - 8M  (широкий диапазон)

Линии (сверху вниз):
[Фиолетовая толстая ━━━]     Юр. Long (7.2M)
[Красная толстая ━━━]        Юр. Short (6.8M)
[Зеленая тонкая ━━]          Физ. Long (1.2M)
[Голубая тонкая ━━]          Физ. Short (1.0M)
[Золотая пунктир - - -]      Юр. NET (+400K)
[Белая пунктир - -]          Физ. NET (+200K)
```

**Визуальная иерархия:**
- ✅ Юр. линии (толстые) **доминируют**
- ✅ Физ. линии (тонкие) **видны**, но менее заметны
- ✅ NET линии (пунктир) легко **отличить** от Long/Short

**Консоль:**
```
[FuturesDashboard] 👁️ Visible lines: {
  yur: { long: true, short: true, net: true },
  fiz: { long: true, short: true, net: true }
}
[FuturesDashboard] ➕ Added Юр. Long values
[FuturesDashboard] ➕ Added Юр. Short values
[FuturesDashboard] ➕ Added Юр. NET values
[FuturesDashboard] ➕ Added Физ. Long values
[FuturesDashboard] ➕ Added Физ. Short values
[FuturesDashboard] ➕ Added Физ. NET values
[FuturesDashboard] 📐 Domain: { final: [-500000, 8000000] }
```

**Debug Info:**
```
Видимых линий: 6 из 6  ← ВСЕ линии активны!
```

---

## ✅ Тест #6: Stats Grid синхронизация

### Проверка
Посмотрите на карточки статистики

### Ожидаемое

**8 карточек (4x2):**
```
┌────────────┬────────────┬────────────┬────────────┐
│ Юр. Long👁️│ Юр. Short👁️│ Юр. NET 👁️│ Цена       │
│ 7.2 млн    │ 6.8 млн    │ +400 тыс   │ 95,500 ₽   │
├────────────┼────────────┼────────────┼────────────┤
│ Физ. Long👁️│Физ. Short👁️│ Физ. NET👁️│ Δ (Юр-Физ)│
│ 1.2 млн    │ 1.0 млн    │ +200 тыс   │ +200 тыс   │
└────────────┴────────────┴────────────┴────────────┘
```

**Проверки:**
- ✅ Eye иконка `👁️` есть **только** у видимых линий
- ✅ Юр. NET = Юр. Long - Юр. Short = 7.2M - 6.8M = **+400K** ✓
- ✅ Физ. NET = Физ. Long - Физ. Short = 1.2M - 1.0M = **+200K** ✓
- ✅ Delta = Юр. NET - Физ. NET = 400K - 200K = **+200K** ✓

---

## ✅ Тест #7: Omni-Search

### Действие
1. Кликните в поле "🔍 Поиск фьючерсов..."
2. Введите "**G**"

### Ожидаемое

**Dropdown:**
```
┌─────────────────────────────────────┐
│ Найдено: ~30 контрактов            │
├─────────────────────────────────────┤
│ GAZR-3.26   GAZR-3.26   2026-03-15 │
│ GOLD-3.26   GOLD-3.26   2026-03-15 │
│ GDH6        GD-3.26     2026-03-15 │
│ ...                                 │
└─────────────────────────────────────┘
```

### Действие
Кликните на "**GOLD-3.26**"

### Ожидаемое
- ✅ Dropdown **закрылся**
- ✅ Поле поиска **очистилось**
- ✅ "Текущий актив: **GOLD**"
- ✅ График **обновился** с новыми данными

**Консоль:**
```
[useFutoiCandles] 🔍 Fetching candles for GOLD
[MOEX] 📊 Processing FUTOI records...
[FuturesDashboard] 🔄 Processing chart data...
```

---

## 🐛 Если что-то не работает

### Проблема: Линия не появляется

**Диагностика:**
1. Проверьте консоль:
   ```
   [FuturesDashboard] ➕ Added Юр. Long values
   ```
2. Если лога нет → state не изменился

**Решение:**
- Жесткое обновление: `Ctrl+Shift+R`
- Проверьте, что кнопка изменила цвет

---

### Проблема: Y-ось не пересчитывается

**Симптом:** После toggle линии диапазон остался прежним

**Диагностика:**
Консоль должна показать:
```
[FuturesDashboard] 📐 Domain: { final: [NEW_MIN, NEW_MAX] }
```

**Решение:**
Проверьте dependencies в `useMemo`:
```typescript
}, [chartData, showYurLong, showYurShort, showYurNet, showFizLong, showFizShort, showFizNet])
   ↑ Все 6 toggle states должны быть здесь!
```

---

### Проблема: Физ. линии не видны

**Симптом:** Физ. Long/Short/NET показаны, но на графике не видны

**Причина:** Масштаб! Юр. линии (7M) "давят" Физ. линии (1M)

**Решение:**
1. **Скрыть** все Юр. линии (клик на каждую)
2. Y-ось автоматически **пересчитается** под Физ. линии
3. Физ. линии **растянутся** на весь экран

---

## ✅ Успешный тест = ВСЕ галочки ✓

- [x] По умолчанию: Цена + Юр. NET
- [x] Toggle: Кнопки меняют цвет/иконку
- [x] График: Линии появляются/исчезают
- [x] Dynamic Scaling: Y-ось пересчитывается
- [x] Физ. Long: Растягивается при скрытии Юр.
- [x] Long vs Short: Обе толстые, видны отчетливо
- [x] Все 6 линий: Визуальная иерархия (толщ./цвет)
- [x] Stats Grid: Eye иконки синхронизированы
- [x] Omni-Search: Выбор фьючерса работает
- [x] Консоль: Логи Domain расчетов

---

## 🎉 Все работает?

**ОТЛИЧНО!** Теперь у вас есть **профессиональный инструмент** для анализа открытых позиций с **6 независимыми линиями** и **Dynamic Y-Axis Scaling**! 🚀

**Читайте полную документацию:**  
`ПОЛНЫЙ_АНАЛИЗ_ПОЗИЦИЙ.md` - Все детали, примеры, математика
