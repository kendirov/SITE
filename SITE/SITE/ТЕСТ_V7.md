# ⚡ Быстрый тест V7 - Professional Dashboard

## Запуск
```bash
cd SITE
npm run dev
```

**Откройте:** `http://localhost:5173/futures-dashboard`

---

## ✅ Тест #1: Рекурсивная пагинация (30 сек)

### Действие
1. Откройте DevTools (F12)
2. Выберите Si
3. Выберите "14D" (14 дней)

### Ожидаемая консоль

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
[MOEX] 📊 Starting RECURSIVE FUTOI fetch for Si
[MOEX] 📅 Range: 2026-01-20 → 2026-02-03
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
[MOEX] 📦 Fetching batch 1 (start=0, limit=100)
[MOEX] ✅ Batch 1: Retrieved 100 records
[MOEX] 📦 Fetching batch 2 (start=100, limit=100)
[MOEX] ✅ Batch 2: Retrieved 100 records
[MOEX] 📦 Fetching batch 3 (start=200, limit=100)
[MOEX] ✅ Batch 3: Retrieved 100 records
[MOEX] 📦 Fetching batch 4 (start=300, limit=100)
[MOEX] ✅ Batch 4: Retrieved 36 records
[MOEX] 🏁 Pagination complete (partial batch)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
[MOEX] 🎉 FUTOI COMPLETE: 336 total records
[MOEX] 📊 Batches processed: 4
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

[MOEX] 📈 Starting RECURSIVE CANDLES fetch for Si
[MOEX] 🎯 Using nearest contract: SiH6
[MOEX] 📦 Fetching candles batch 1 (start=0)
[MOEX] ✅ Batch 1: Retrieved 336 candles
[MOEX] 🏁 Candles pagination complete (partial batch)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
[MOEX] 🎉 CANDLES COMPLETE: 336 total candles
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

### Проверки
- ✅ Видите "Batches processed: 4" для FUTOI?
- ✅ Видите "FUTOI COMPLETE: 336 total"?
- ✅ Видите "CANDLES COMPLETE: 336 total"?
- ✅ Total records > 100 (было ограничение)?

---

## ✅ Тест #2: Свечной график (10 сек)

### Визуальная проверка

**Левая Y-ось:**
```
ЦЕНА ← Cyan, bold, uppercase
```

**График:**
```
┌────────────────────┐
│  ╔═╗  ╔═╗  ╔═╗   │ ← Зеленые свечи (bullish)
│  ║ ║  ║ ║  ║ ║   │
│  ╚═╝  ║ ║  ╚═╝   │
│       ╚═╝         │
│  ╔═╗              │ ← Красные свечи (bearish)
│  ║ ║              │
│  ╚═╝              │
└────────────────────┘
```

**Правая Y-ось:**
```
ПОЗИЦИИ ← Purple, bold, uppercase
```

### Проверки
- ✅ График показывает **свечи** (не area)?
- ✅ Свечи **зеленые** (bullish) или **красные** (bearish)?
- ✅ Видны **фитили** (тонкие линии High-Low)?
- ✅ Левая ось **cyan**, правая **purple**?
- ✅ Оси **жирные** (2px)?
- ✅ Labels **UPPERCASE**?

---

## ✅ Тест #3: HUD Stats (5 сек)

### Ожидаемое

**Верхняя панель (компактная полоса):**
```
[Цена: 95,450] [Юр.L: 4.5M👁️] [Юр.S: 4.1M] [Юр.NET: 400K👁️] [Физ.L: 1.5M] [Физ.S: 1.3M] [Физ.NET: 200K] [Δ: 200K]
```

### Проверки
- ✅ HUD **сверху** (не снизу)?
- ✅ Все метрики в **одну горизонтальную линию**?
- ✅ Eye icons (👁️) показывают **видимые линии**?
- ✅ Числа в **компактном формате** (4.5M, не 4,500,000)?
- ✅ **Monospace** шрифт?
- ✅ HUD занимает **~80px** (компактно)?

---

## ✅ Тест #4: Custom Tooltip (10 сек)

### Действие
Наведите мышь на **любую свечу**

### Ожидаемое
```
┌────────────────────┐
│ 10:00              │ ← Время
│ ─────────────────  │
│ Open: 95,400       │ ← OHLC данные
│ High: 95,500       │
│ Low: 95,300        │
│ Close: 95,450 ₽    │
│ ─────────────────  │
│ Юр. Long: 4.5M     │ ← Open Interest (6 метрик)
│ Юр. Short: 4.1M    │
│ Юр. NET: 400K      │
│ ─────────────────  │
│ Физ. Long: 1.5M    │
│ Физ. Short: 1.3M   │
│ Физ. NET: 200K     │
└────────────────────┘
```

### Проверки
- ✅ Tooltip показывает **OHLC** (4 метрики)?
- ✅ Tooltip показывает **Open Interest** (6 метрик)?
- ✅ Числа **компактные** (4.5M)?
- ✅ Цвета правильные:
  - High: Green
  - Low: Red
  - Close: White
  - Юр.: Purple/Red/Amber
  - Физ.: Green/Cyan/White

---

## ✅ Тест #5: Toggle + Dynamic Scaling (15 сек)

### Действие #1: Скрыть Юр.NET
1. Кликните кнопку "Юр.NET" (золотая)

### Ожидаемое
- Золотая линия (Юр.NET) **исчезла** с графика
- Кнопка стала **серой** (bg-zinc-900)
- Eye icon изменился на **EyeOff**
- HUD badge "👁️ Юр.NET" **исчез**
- **Y-ось правая пересчиталась** (диапазон изменился)

### Консоль (DevTools)
```
[FuturesDashboardV7] 📊 Calculating dynamic Y-axis domain...
[FuturesDashboardV7] 👁️ Visible lines: {
  yur: { long: false, short: false, net: false },
  fiz: { long: false, short: false, net: false }
}
```

### Действие #2: Показать ВСЕ линии
1. Кликните все кнопки (Юр.L, Юр.S, Юр.NET, Физ.L, Физ.S, Физ.NET)

### Ожидаемое
- **6 линий** видны на графике
- **6 Eye icons** в HUD
- **6 кнопок** активны (цветные)
- Y-ось **пересчиталась** для отображения всех линий

---

## ✅ Тест #6: Chart Size (5 сек)

### Проверка

**Высота графика:**
```
calc(100vh - 320px)
```

**На экране 1080p:**
- Viewport: 1080px
- Chart: ~760px (70% viewport)

**Было (V6):**
- Chart: 650px (fixed)

**Стало (V7):**
- Chart: **70-80% viewport** (dynamic)

### Проверки
- ✅ График занимает **большую часть** экрана?
- ✅ График **динамический** (меняется при resize окна)?
- ✅ HUD stats **компактны** сверху (не снизу)?

---

## ✅ Тест #7: Omni-Search (10 сек)

### Действие
1. Введите в поиск "**BR**"
2. Кликните на "**BRH6**"

### Ожидаемое

**Консоль:**
```
[MOEX] 📊 Starting RECURSIVE FUTOI fetch for BR
[MOEX] 🎯 Using nearest contract: BRH6
[MOEX] 🎉 FUTOI COMPLETE: X total records
[MOEX] 🎉 CANDLES COMPLETE: X total candles
```

**UI:**
- HUD stats обновились (новые значения для BR)
- График показывает **свечи нефти** (BR)
- Левая Y-ось показывает **цены BR** (не Si)

### Проверки
- ✅ Консоль показывает "fetch for BR"?
- ✅ График обновился с **новыми данными**?
- ✅ HUD stats показывают **другие значения**?

---

## 🐛 Если что-то не работает

### Проблема #1: Свечи не видны (все еще Area chart)

**Симптом:**
График показывает синюю область (не свечи)

**Диагностика:**
1. Откройте DevTools → Elements
2. Найдите `<Bar dataKey="close">`
3. Проверьте, есть ли `shape={<Candlestick />}`

**Решение:**
Жесткое обновление: `Ctrl+Shift+R`

---

### Проблема #2: HUD stats не компактны

**Симптом:**
HUD занимает много места (как в V6)

**Диагностика:**
1. Откройте `/futures-dashboard`
2. Убедитесь, что вы на **V7**, не V6
3. URL должен быть `/futures-dashboard` (не `/futures-dashboard-v6`)

**Решение:**
Перейдите на `/futures-dashboard` (без v6)

---

### Проблема #3: Рекурсивная пагинация не работает

**Симптом:**
Консоль показывает "Retrieved 100 records" (только 1 батч)

**Диагностика:**
1. Проверьте `moex-client.ts`
2. Найдите `getFuturesOpenInterest`
3. Убедитесь, что есть `while (true)` loop

**Решение:**
Убедитесь, что изменения в `moex-client.ts` сохранены

---

### Проблема #4: Tooltip не показывает OHLC

**Симптом:**
Tooltip показывает только OI (Open Interest)

**Причина:**
Данные свечей не загружены или не merged

**Решение:**
Проверьте консоль:
```
[useFutoiCandles] ✅ Merged X/Y candles with price
```

Если X << Y, то price data не matched. Возможно, проблема с timestamp matching.

---

## ✅ Успешный тест = ВСЕ галочки ✓

- [x] Консоль: Recursive pagination logs (Batches processed: 4)
- [x] Консоль: FUTOI COMPLETE: 336 records
- [x] Консоль: CANDLES COMPLETE: 336 candles
- [x] График: Candlesticks видны (green/red)
- [x] График: Фитили (wicks) видны
- [x] Y-оси: CYAN (left), PURPLE (right)
- [x] HUD: Компактная полоса сверху
- [x] HUD: Все метрики в 1 линию
- [x] HUD: Compact numbers (4.5M)
- [x] Tooltip: OHLC + OI (10 метрик)
- [x] Toggle: Lines hide/show работает
- [x] Toggle: Y-axis rescales (console logs)
- [x] Chart: 70-80% viewport height
- [x] Omni-Search: Futures selection works

---

## 🎉 Все работает?

**ОТЛИЧНО!** Теперь у вас:

✅ **Рекурсивная пагинация** - ВСЕ данные MOEX  
✅ **Candlestick Chart** - Профессиональный свечной график  
✅ **HUD Stats** - Компактная панель сверху  
✅ **Expensive Minimalism** - Deep Dark + Monospace  
✅ **Dynamic Y-Axis Scaling** - Автопересчет  
✅ **Custom Tooltip** - OHLC + Open Interest  

**ГОТОВО К PRODUCTION!** 🚀📈🎯

---

**Полная документация:**  
`V7_PROFESSIONAL_DASHBOARD.md` - Все детали, архитектура, примеры
