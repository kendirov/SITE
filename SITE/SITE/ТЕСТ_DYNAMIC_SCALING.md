# ⚡ Быстрый тест - Dynamic Y-Axis Scaling

## Запуск
```bash
cd SITE
npm run dev
```

Откройте: `http://localhost:5173/futures-dashboard`

---

## ✅ Тест #1: Проблема масштаба (Репродукция)

### Действие
1. Откройте страницу
2. Убедитесь, что **обе кнопки активны**:
   - `👁️ Умные деньги NET` (фиолетовая)
   - `👁️ Толпа NET` (зеленая)

### Ожидаемое
```
График:
┌──────────────────────────────────┐
│ Y-ось: 7M, 5M, 3M, 1M, 0        │
│ [Фиолетовая линия ╱╲╱╲]  ← Видно│
│ [Зеленая линия _____]      ← НЕ ВИДНО (плоская!)
└──────────────────────────────────┘
```

**Проверки:**
- ✅ Фиолетовая линия **видна отчетливо**?
- ✅ Зеленая линия **плоская** (почти горизонтальная)?
- ✅ Y-ось справа: большой диапазон (0 - 7M)?

**Консоль (F12):**
```
[FuturesDashboard] 📐 Domain: { final: [647500, 7502500] }
                                        ↑ Большой диапазон
```

---

## ✅ Тест #2: Dynamic Scaling (Решение)

### Действие
1. **Кликните** на кнопку `👁️ Умные деньги NET` (скрыть Smart)

### Ожидаемое
```
График:
┌──────────────────────────────────┐
│ Y-ось: 1.05M, 1.00M, 0.95M      │ ← УЗКИЙ диапазон!
│ [Зеленая линия ╱╲╱╲╱]    ← ТЕПЕРЬ ВИДНО!
└──────────────────────────────────┘
```

**Проверки:**
- ✅ Фиолетовая линия **исчезла**?
- ✅ Зеленая линия **растянулась** на весь экран?
- ✅ Y-ось справа: маленький диапазон (0.95M - 1.05M)?
- ✅ Кнопка `👁️off Умные` стала **серой**?

**Консоль (F12):**
```
[FuturesDashboard] 👁️ Visible lines: { showSmart: false, showRetail: true }
[FuturesDashboard] 📐 Domain: { final: [945000, 1055000] }
                                        ↑ УЗКИЙ диапазон!
[CorrelationChart] 🎨 Rendering with domain: [945000, 1055000]
```

**Debug Info под кнопками:**
```
Текущий диапазон Y-оси (правая): [945000, 1055000]
```

---

## ✅ Тест #3: Обратное переключение

### Действие
1. **Кликните** на `👁️off Умные деньги NET` еще раз (показать Smart)
2. **Кликните** на `👁️ Толпа NET` (скрыть Retail)

### Ожидаемое
```
График:
┌──────────────────────────────────┐
│ Y-ось: 7.2M, 7.0M, 6.8M         │ ← Узкий для деталей Smart
│ [Фиолетовая линия ╱╲╱╲]  ← Детали видны!
└──────────────────────────────────┘
```

**Проверки:**
- ✅ Зеленая линия **исчезла**?
- ✅ Фиолетовая линия **показывает детали**?
- ✅ Y-ось: узкий диапазон (~6.8M - 7.2M)?

**Консоль:**
```
[FuturesDashboard] 👁️ Visible lines: { showSmart: true, showRetail: false }
[FuturesDashboard] 📐 Domain: { final: [6780000, 7220000] }
```

---

## ✅ Тест #4: Omni-Search

### Действие
1. Кликните в поле "🔍 Поиск фьючерсов..."
2. Введите "**BR**"

### Ожидаемое
```
Dropdown:
┌────────────────────────────────┐
│ Найдено: 12 контрактов        │
├────────────────────────────────┤
│ BRH6     BR-3.26    2026-03-15│
│ BRM6     BR-6.26    2026-06-15│
│ ...                            │
└────────────────────────────────┘
```

**Проверки:**
- ✅ Dropdown **открылся**?
- ✅ Показаны только контракты с "BR"?
- ✅ Кнопка "**Очистить**" появилась?

### Действие
1. **Кликните** на "BRH6"

### Ожидаемое
```
Текущий актив: BR
```

**Проверки:**
- ✅ Dropdown **закрылся**?
- ✅ Поле поиска **очистилось**?
- ✅ График **обновился** с новыми данными?

---

## ✅ Тест #5: Divergence Badge

### Ожидаемое (если есть дивергенция)

**Медвежья:**
```
┌──────────────────────────────────────────┐
│ ↓ ДИВЕРГЕНЦИЯ (Медвежья)                │
│ Цена растет, умные деньги уходят        │
└──────────────────────────────────────────┘
```

**Бычья:**
```
┌──────────────────────────────────────────┐
│ ↑ ДИВЕРГЕНЦИЯ (Бычья)                   │
│ Цена падает, умные деньги входят        │
└──────────────────────────────────────────┘
```

**Конвергенция:**
```
┌──────────────────────────────────────────┐
│ ⚡ КОНВЕРГЕНЦИЯ                          │
│ Цена и умные деньги движутся вместе     │
└──────────────────────────────────────────┘
```

**Проверки:**
- ✅ Badge **над Omni-Search**?
- ✅ Правильный цвет (красный/зеленый/фиолетовый)?
- ✅ Правильная иконка (↓, ↑, ⚡)?

---

## 🐛 Если что-то не работает

### Проблема: Retail линия все еще плоская

**Симптом:** После скрытия Smart линия Retail осталась плоской

**Диагностика:**
1. Проверьте консоль:
   ```
   [FuturesDashboard] 📐 Domain: { final: [945000, 1055000] }
   ```
2. Проверьте, что domain **изменился**

**Если domain не изменился:**
- Жесткое обновление: `Ctrl+Shift+R`
- Проверьте, что кнопка стала **серой** (линия действительно скрыта)

**Решение:**
Проверьте код:
```typescript
const rightAxisDomain = useMemo(..., [chartData, showSmart, showRetail])
                                        ↑ Dependencies
```

---

### Проблема: Кнопки не меняют цвет

**Симптом:** Клик на кнопку не меняет ее состояние

**Решение:**
Проверьте условие:
```typescript
className={`... ${
  showSmart
    ? 'bg-purple-600/20 ...'  // Активна
    : 'bg-zinc-900/50 ...'    // Скрыта
}`}
```

Убедитесь, что state `showSmart` меняется:
```javascript
console.log('showSmart:', showSmart)
```

---

### Проблема: График не перерисовывается

**Симптом:** После toggle график остается прежним

**Решение:**
Проверьте, что `CorrelationChart` получает новый prop:
```typescript
<CorrelationChart
  rightAxisDomain={rightAxisDomain}  // ← Должен измениться
  ...
/>
```

И что внутри используется:
```typescript
<YAxis
  yAxisId="positions"
  domain={rightAxisDomain}  // ← Prop из parent
  ...
/>
```

---

## ✅ Успешный тест = ВСЕ галочки ✓

- [x] Консоль: Логи расчета domain видны
- [x] График: Retail **плоская** при Smart видимой
- [x] Toggle Smart: Retail **растягивается**
- [x] Y-ось: Диапазон **меняется** (7M → 1M)
- [x] Кнопки: Меняют цвет (фиолетовый/серый)
- [x] Иконки: Eye/EyeOff переключаются
- [x] Debug Info: Показывает текущий domain
- [x] Omni-Search: Фильтрация работает
- [x] Stats Grid: 4 карточки с данными

---

## 🎉 Все работает?

**ОТЛИЧНО!** Dynamic Y-Axis Scaling™ полностью решает проблему масштаба! 🚀

**Теперь вы можете:**
- ✅ Анализировать **Retail отдельно** (скрыв Smart)
- ✅ Анализировать **Smart отдельно** (скрыв Retail)
- ✅ Видеть **обе линии вместе** (для корреляции)
- ✅ **Без визуальных искажений**

**Есть проблемы?**  
Смотри полную документацию: `DYNAMIC_Y_AXIS_SCALING.md`
