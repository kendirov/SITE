# ⚡ Быстрый тест - Super Correlation Chart

## Запуск
```bash
cd SITE
npm run dev
```

Откройте: `http://localhost:5173/futures-dashboard`

---

## ✅ Проверка #1: Консоль (F12)

**Ожидаемые логи:**
```
[useActiveFutures] 🔍 Fetching active futures list...
[MOEX] 🔍 Fetching ALL active futures from FORTS...
[MOEX] ✅ Retrieved 287 active futures
[useActiveFutures] 📊 Retrieved 287 contracts

[useFutoiCandles] 🔍 Fetching candles for Si
[useFutoiCandles] 📅 Period: 1 days (2026-02-03 → 2026-02-03)
[MOEX] 📊 Processing 120 FUTOI records into candles...
[MOEX] ✅ Processed into 60 FUTOI candles
```

### Ключевые проверки:
- ✅ Загрузка **списка фьючерсов** (200-300 контрактов)?
- ✅ Загрузка **FUTOI candles** для Si?
- ✅ Нет ошибок API?

---

## ✅ Проверка #2: Super Correlation Chart

**Ожидаемая визуализация:**
```
┌──────────────────────────────────────────────────────┐
│ ⚡ Корреляция: Цена × Умные деньги                  │
│                                                      │
│ [──] Цена  [━━━] Умные NET  [- - -] Толпа NET      │
├──────────────────────────────────────────────────────┤
│ Цена ↑                                          ↑ NET│
│ 95K  │ [Темная область]                        500K │
│      │ [Фиолетовая линия (толстая)]            400K │
│ 94K  │ [Зеленая линия (пунктир)]               300K │
│      │                                          200K │
│ 93K  │                                          100K │
│      └──────────────────────────────────────────     │
│        10:00  11:00  12:00  13:00  14:00             │
└──────────────────────────────────────────────────────┘
```

### Ключевые проверки:

#### Фоновая область (Цена)
- ✅ **Темно-серая** область видна?
- ✅ **Полупрозрачная** (opacity ~0.3)?
- ✅ Градиент от светлого к прозрачному?

#### Фиолетовая линия (Умные NET)
- ✅ **Толстая** линия (заметно толще зеленой)?
- ✅ **Яркий фиолетовый** цвет (#8b5cf6)?
- ✅ **Непрерывная** (не пунктирная)?

#### Зеленая линия (Толпа NET)
- ✅ **Пунктирная** (видны пробелы)?
- ✅ **Тоньше** фиолетовой?
- ✅ Зеленый цвет (#10b981)?

#### Две Y-оси
- ✅ **Слева:** Подписи в формате "95K", "94K"?
- ✅ **Справа:** Подписи в формате "300 тыс"?
- ✅ Вертикальные labels: "Цена" (слева), "NET Позиции" (справа)?

---

## ✅ Проверка #3: Divergence Badges

**Ожидаемое:** Badge **над** графиком

### Если данных мало
- Badge может **отсутствовать** (нужно минимум 10 точек)

### Если есть дивергенция

**Медвежья:**
```
┌──────────────────────────────────────────┐
│ ↓ ДИВЕРГЕНЦИЯ (Медвежья)                │ ← Красный фон
│   Цена растет, умные деньги уходят      │
└──────────────────────────────────────────┘
```

**Бычья:**
```
┌──────────────────────────────────────────┐
│ ↑ ДИВЕРГЕНЦИЯ (Бычья)                   │ ← Зеленый фон
│   Цена падает, умные деньги входят      │
└──────────────────────────────────────────┘
```

**Конвергенция:**
```
┌──────────────────────────────────────────┐
│ ⚡ КОНВЕРГЕНЦИЯ                          │ ← Фиолетовый фон
│   Цена и умные деньги движутся вместе   │
└──────────────────────────────────────────┘
```

**Проверки:**
- ✅ Badge **над графиком**?
- ✅ Правильная **иконка** (↓, ↑, или ⚡)?
- ✅ Правильный **цвет** фона?
- ✅ Текст **понятный**?

---

## ✅ Проверка #4: Omni-Search

### Шаг 1: Открытие поиска
**Действие:** Кликните в поле "Поиск фьючерсов..."

**Ожидаемое:**
- ✅ Dropdown **открывается**?
- ✅ Список показывает **несколько контрактов**?
- ✅ Формат строки: `SiH6    Si-3.26    2026-03-15`?

### Шаг 2: Фильтрация
**Действие:** Введите "**G**"

**Ожидаемое:**
- ✅ Список **фильтруется**?
- ✅ Показываются только контракты с "G" (GAZR, GOLD)?
- ✅ Кнопка "**Очистить**" появляется?

### Шаг 3: Выбор контракта
**Действие:** Кликните на "**GAZR-3.26**"

**Ожидаемое:**
- ✅ Dropdown **закрывается**?
- ✅ Поле поиска **очищается**?
- ✅ Внизу: "Текущий контракт: **GAZR**"?
- ✅ График **обновляется** (новый запрос к API)?

### Шаг 4: Очистка поиска
**Действие:** Кликните "**Очистить**"

**Ожидаемое:**
- ✅ Поле поиска **пустое**?
- ✅ Dropdown **закрывается**?

---

## ✅ Проверка #5: Stats Grid

**Ожидаемое:**
```
┌──────────────┬──────────────┬──────────────┬──────────────┐
│ Текущая цена │ Умные NET    │ Толпа NET    │ Δ (разница)  │
│ 95,500       │ 300 тыс      │ 50 тыс       │ +250 тыс     │
│ ₽            │ Юр. лица     │ Физ. лица    │ Разница      │
└──────────────┴──────────────┴──────────────┴──────────────┘
```

### Ключевые проверки:

**Карточка 1: Цена**
- ✅ Цвет **Cyan** (#06b6d4)?
- ✅ Формат с разделителями: "**95,500**"?
- ✅ Символ рубля внизу?

**Карточка 2: Умные NET**
- ✅ Цвет **Purple** (#8b5cf6)?
- ✅ Формат: "**300 тыс**" (не "300K")?
- ✅ Граница карточки **фиолетовая**?

**Карточка 3: Толпа NET**
- ✅ Цвет **Green** (#10b981)?
- ✅ Формат: "**50 тыс**"?
- ✅ Граница карточки **зеленая**?

**Карточка 4: Delta**
- ✅ Цвет **динамический** (фиолетовый/красный)?
- ✅ Формат: "**+250 тыс**"?
- ✅ Префикс "**+**" для положительных?

---

## 🐛 Если что-то не работает

### Проблема: Нет фиолетовой/зеленой линии

**Симптом:** Виден только серый фон (цена)

**Диагностика:**
1. Откройте консоль (F12)
2. Проверьте:
   ```
   [MOEX] ✅ Processed into 60 FUTOI candles
   ```

**Если candles = 0:**
- Попробуйте другой актив (BR, RI)
- Увеличьте период: "14 Дней"

**Решение:**
```typescript
// Проверьте, что данные содержат yur_net и fiz_net
console.log('Chart Data:', chartData)
```

---

### Проблема: Две оси показывают одинаковые числа

**Симптом:** Левая и правая ось дублируют друг друга

**Решение:**
Проверьте `yAxisId`:
```typescript
<YAxis yAxisId="price" orientation="left" ... />
<YAxis yAxisId="positions" orientation="right" ... />

<Area yAxisId="price" dataKey="price" ... />
<Line yAxisId="positions" dataKey="yur_net" ... />
```

Убедитесь, что:
- ✅ Area привязана к `yAxisId="price"`
- ✅ Lines привязаны к `yAxisId="positions"`

---

### Проблема: Пунктирная линия не пунктирная

**Симптом:** Зеленая линия сплошная (не пунктир)

**Решение:**
Проверьте `strokeDasharray`:
```typescript
<Line
  dataKey="fiz_net"
  stroke="#10b981"
  strokeDasharray="5 5"  // ← КРИТИЧНО
  strokeWidth={2}
/>
```

---

### Проблема: Omni-Search не открывается

**Симптом:** Клик в поле - dropdown не появляется

**Решение:**
Проверьте state:
```typescript
const [showSearch, setShowSearch] = useState(false)

<input
  onFocus={() => setShowSearch(true)}  // ← КРИТИЧНО
  ...
/>
```

---

### Проблема: Badge дивергенции не появляется

**Симптом:** Над графиком пусто (нет badge)

**Причины:**
1. Данных меньше 10 точек
2. Нет дивергенции (конвергенция)

**Решение:**
```typescript
// Проверьте функцию detectDivergence
const divergence = detectDivergence(chartData)
console.log('Divergence:', divergence)
```

Если `null` - недостаточно данных (увеличьте период).

---

## ✅ Успешный тест = ВСЕ галочки ✓

- [x] Консоль: Список фьючерсов загружен (200-300)
- [x] Консоль: FUTOI candles обработаны (> 0)
- [x] График: Темная область (цена) видна
- [x] График: Фиолетовая линия **толстая**
- [x] График: Зеленая линия **пунктирная**
- [x] Оси: Слева "Цена", справа "NET Позиции"
- [x] Badge: Дивергенция обнаружена (если есть)
- [x] Omni-Search: Dropdown открывается
- [x] Omni-Search: Фильтрация работает
- [x] Stats Grid: 4 карточки с данными
- [x] Tooltip: Темный, русские числа

---

## 🎉 Все работает?

**ОТЛИЧНО!** Super Correlation Chart революционизирует анализ фьючерсов! 🚀

**Есть проблемы?**  
Смотри полную документацию: `SUPER_CORRELATION_CHART.md`
